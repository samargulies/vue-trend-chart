!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t=t||self)["vue-trend-chart"]=e(t.vue)}(this,function(n){"use strict";function t(t){var e=t.split(" ").filter(function(t){return""!==t}).map(function(t){return parseInt(t)});switch(e.length){case 4:return{top:e[0],right:e[1],bottom:e[2],left:e[3]};case 3:return{top:e[0],right:e[1],bottom:e[2],left:e[1]};case 2:return{top:e[0],right:e[1],bottom:e[0],left:e[1]};default:return{top:e[0],right:e[0],bottom:e[0],left:e[0]}}}var a={name:"TrendChartGrid",compatConfig:{RENDER_FUNCTION:!1},props:{boundary:{required:!0,type:Object},verticalLines:{default:!1,type:Boolean},verticalLinesNumber:{default:0,type:Number},horizontalLines:{default:!1,type:Boolean},horizontalLinesNumber:{default:0,type:Number}},methods:{setVerticalLinesParams:function(t){var e=this.boundary,i=this.verticalLinesNumber,i=1<i?(e.maxX-e.minX)/(i-1):0,t=e.minX+i*(t-1);return{x1:t,x2:t,y1:e.minY,y2:e.maxY,stroke:"rgba(0,0,0,0.1)"}},setHorizontalLinesParams:function(t){var e=this.boundary,i=this.horizontalLinesNumber,i=1<i?(e.maxY-e.minY)/(i-1):0,t=e.maxY-i*(t-1);return{x1:e.minX,x2:e.maxX,y1:t,y2:t,stroke:"rgba(0,0,0,0.1)"}}},render:function(){if(this.verticalLines||this.horizontalLines){var t=[];if(this.verticalLines&&0<this.verticalLinesNumber){for(var e=[],i=1;i<=this.verticalLinesNumber;i++)e.push(n.h("line",{class:"line",attrs:Object.assign({},this.setVerticalLinesParams(i))}));t.push(n.h("g",{class:"vertical"},e))}if(this.horizontalLines&&0<this.horizontalLinesNumber){for(var a=[],s=1;s<=this.horizontalLinesNumber;s++)a.push(n.h("line",{class:"line",attrs:Object.assign({},this.setHorizontalLinesParams(s))}));t.push(n.h("g",{class:"horizontal"},a))}return n.h("g",t)}}},s={name:"TrendChartLabels",compatConfig:{RENDER_FUNCTION:!1},props:{boundary:{required:!0,type:Object},minValue:{type:Number},maxValue:{type:Number},xLabels:{type:Array},yLabels:{type:Number},yLabelsTextFormatter:{default:function(t){return t},type:Function}},data:function(){return{xLabelHeight:null,yLabelHeight:null}},methods:{setXLabelsParams:function(t){var e=this.boundary,i=this.xLabels,i=(e.maxX-e.minX)/(i.length-1);return{transform:"translate("+(e.minX+i*t)+", "+e.maxY+")"}},setYLabelsParams:function(t){var e=this.boundary,i=this.yLabels,i=(e.maxY-e.minY)/(i-1);return{transform:"translate("+e.minX+", "+(e.maxY-i*t)+")"}}},mounted:function(){this.xLabels&&this.xLabels.length&&(this.xLabelHeight=this.$refs.xLabels.querySelector("text").getBoundingClientRect().height),this.yLabels&&0<this.yLabels&&(this.yLabelHeight=this.$refs.yLabels.querySelector("text").getBoundingClientRect().height)},render:function(){var i=this;if(this.xLabels&&this.xLabels.length||this.yLabels&&0<this.yLabels){var t=[];if(this.xLabels&&this.xLabels.length&&t.push(n.h("g",{class:"x-labels",ref:"xLabels"},this.xLabels.map(function(t,e){return n.h("g",{class:"label",attrs:Object.assign({},i.setXLabelsParams(e))},[n.h("text",{attrs:{dy:i.xLabelHeight+5,"text-anchor":"middle"}},t),n.h("line",{attrs:{stroke:"rgba(0,0,0,0.1)",y2:5}})])}))),this.yLabels&&0<this.yLabels){for(var e=[],a=0;a<this.yLabels;a++)e.push(n.h("g",{class:"label",attrs:Object.assign({},this.setYLabelsParams(a))},[n.h("text",{attrs:{dx:-10,dy:this.yLabelHeight/4,"text-anchor":"end"}},this.yLabelsTextFormatter(this.minValue+(this.maxValue-this.minValue)/(this.yLabels-1)*a)),n.h("line",{attrs:{stroke:"rgba(0,0,0,0.1)",x1:0,x2:-5}})]));t.push(n.h("g",{class:"y-labels",ref:"yLabels"},e))}return n.h("g",t)}}};var r={name:"TrendChartCurve",compatConfig:{RENDER_FUNCTION:!1},props:{boundary:{required:!0,type:Object},minValue:{required:!0,type:Number},maxValue:{required:!0,type:Number},maxAmount:{required:!0,type:Number},activeLineParams:{type:Object},data:{required:!0,type:Array},className:{type:String},smooth:{default:!1,type:Boolean},stroke:{default:!0,type:Boolean},fill:{default:!1,type:Boolean},showPoints:{default:!1,type:Boolean}},computed:{points:function(){return function(t,e,i,a,s){var n=e.minX,r=e.minY,h=e.maxX,o=e.maxY;t=t.map(function(t){return"number"==typeof t?t:t.value});var l=a-.001,u=(h-n)/(s-1),m=(o-r)/(i+.001-l);return t.map(function(t,e){return{x:e*u+n,y:o-(t-l)*m+1e-5*(e===s-1)-1e-5*(0===e)}})}(this.data,this.boundary,this.maxValue,this.minValue,this.maxAmount)},paths:function(){return t=this.points,i=this.smooth,e=this.boundary,a=e.maxY,s=[].concat(t),n=s.shift(),e=s[s.length-1],r=(s[0].x-n.x)/2,h="M "+n.x+","+n.y,s.forEach(function(t,e){i?(e=s[e-1]||n,h+=" C "+(r+e.x)+","+e.y+" "+(r+e.x)+","+t.y+" "+t.x+","+t.y):h+=" L"+t.x+","+t.y}),t=h,e.Y!==a&&(t+=" L"+e.x+","+a),n.Y!==a&&(t+=" L"+n.x+","+a),{linePath:h,fillPath:t+=" Z"};var t,i,e,a,s,n,r,h}},render:function(){var i=this,t=[];return this.fill&&this.paths&&this.paths.fillPath&&t.push(n.h("path",{class:"fill",attrs:{d:this.paths.fillPath,fill:"rgba(0,0,0,0.15)"}})),this.stroke&&this.paths&&this.paths.linePath&&t.push(n.h("path",{class:"stroke",attrs:{d:this.paths.linePath,fill:"none",stroke:"black"}})),this.showPoints&&this.points&&t.push(n.h("g",{class:"points"},this.points.map(function(t,e){return n.h("circle",{class:{point:!0,"is-active":i.activeLineParams&&i.activeLineParams.index===e},attrs:{cx:t.x,cy:t.y,r:2,stroke:"#000000","stroke-width":1}})}))),n.h("g",{class:this.className},t)}},e={name:"TrendChart",components:{TrendChartGrid:a,TrendChartLabels:s,TrendChartCurve:r},compatConfig:{RENDER_FUNCTION:!1},props:{datasets:{required:!0,type:Array},grid:{default:null,type:Object},labels:{default:null,type:Object},max:{type:Number},min:{type:Number},padding:{default:"5",type:String,validator:function(t){return!((t=(t=t).split(" ").filter(function(t){return""!==t}).map(function(t){return parseInt(t)})).length<1||4<t.length)&&t.every(function(t){return"number"==typeof t&&0<=t})}},interactive:{default:!1,type:Boolean}},data:function(){return{width:null,height:null,labelsOverflowObject:{top:0,right:0,bottom:0,left:0},activeLine:null,activeLineParams:null}},computed:{paddingObject:function(){return this.padding?t(this.padding):t("0")},boundary:function(){var t=this.width,e=this.height,i=this.paddingObject,a=this.labelsOverflowObject,s={minX:i.left+a.left,minY:i.top+a.top,maxX:t-i.right-a.right,maxY:e-i.bottom-a.bottom};return s},params:function(){var i=-1/0,a=1/0,s=0;return this.datasets.forEach(function(t){var e=t.data.map(function(t){return"number"==typeof t?t:t.value}),t=Math.max.apply(Math,e);i<t&&(i=t);t=Math.min.apply(Math,e);t<a&&(a=t),e.length>s&&(s=e.length)}),void 0!==this.max&&this.max>i&&(i=this.max),void 0!==this.min&&this.min<a&&(a=this.min),{maxValue:i,minValue:a,maxAmount:s}},chartOverlayParams:function(){var t=this.boundary,e=t.maxX-t.minX,i=t.maxY-t.minY;return{x:t.minX,y:t.minY,width:0<e?e:0,height:0<i?i:0,opacity:0}},chartAxesXCoords:function(){for(var t=[],e=(this.boundary.maxX-this.boundary.minX)/(this.params.maxAmount-1),i=0;i<this.params.maxAmount;i++)t.push(e*i+this.boundary.minX);return t}},methods:{setSize:function(){var t=this.$refs.chart.getBoundingClientRect();this.width=t.width,this.height=t.height},fitLabels:function(){var t,e,i,a=this.$refs.chart,s=this.$refs.labels;s&&(s.xLabels&&s.xLabels.length||0<s.yLabels)?(i=a.getBoundingClientRect(),t=s.$el.getBoundingClientRect(),e=i.top-t.top+this.paddingObject.top,a=t.right-i.right+this.paddingObject.right,s=t.bottom-i.bottom+this.paddingObject.bottom,i=this.paddingObject.left-t.left+i.left,this.labelsOverflowObject={top:0<e?e:0,right:0<a?a:0,bottom:0<s?s:0,left:0<i?i:0}):this.labelsOverflowObject={top:0,right:0,bottom:0,left:0}},init:function(){var t=this;this.setSize(),this.$nextTick(function(){t.fitLabels()})},getNearestCoordinate:function(i){return this.chartAxesXCoords.reduce(function(t,e){return Math.abs(t)>Math.abs(e-i)?e-i:t},1/0)+i},mouseMove:function(t){var e;void 0!==this.$refs.chart&&(e=this.$refs.chart.getBoundingClientRect(),this.activeLine=this.getNearestCoordinate(t.clientX-e.left))},mouseOut:function(){this.activeLine=null,this.activeLineParams=null},onWindowResize:function(){this.setSize()}},watch:{activeLine:function(t){var e=this,i=[];t&&(this.activeLineParams={index:this.chartAxesXCoords.indexOf(this.activeLine)},this.datasets.forEach(function(t){i.push(t.data[e.activeLineParams.index])})),this.$emit("mouse-move",this.activeLineParams?Object.assign({},this.activeLineParams,{data:i}):null)},labels:{handler:function(){var t=this;this.labelsOverflowObject={top:0,right:0,bottom:0,left:0},this.$nextTick(function(){t.fitLabels()})},deep:!0}},mounted:function(){this.init(),window.addEventListener("resize",this.onWindowResize)},unmounted:function(){window.removeEventListener("resize",this.onWindowResize)},render:function(){var e=this,i=[];return this.grid&&i.push(n.h(a,{class:"grid",attrs:{verticalLines:this.grid.verticalLines,verticalLinesNumber:this.grid.verticalLinesNumber||this.params.maxAmount,horizontalLines:this.grid.horizontalLines,horizontalLinesNumber:this.grid.horizontalLinesNumber||this.labels&&this.labels.yLabels||0,boundary:this.boundary}})),this.interactive&&this.chartOverlayParams&&i.push(n.h("line",{class:"active-line",ref:"active-line",attrs:{x1:this.activeLine||this.boundary.minX,x2:this.activeLine||this.boundary.minX,y1:this.boundary.minY,y2:this.boundary.maxY,stroke:"black",visibility:this.activeLine?"visible":"hidden"}})),this.labels&&i.push(n.h(s,{class:"labels",ref:"labels",attrs:Object.assign({},this.labels,{boundary:this.boundary,minValue:this.params.minValue,maxValue:this.params.maxValue})})),this.datasets.map(function(t){i.push(n.h(r,{class:"curve",attrs:Object.assign({},t,{boundary:e.boundary,minValue:e.params.minValue,maxValue:e.params.maxValue,maxAmount:e.params.maxAmount,activeLineParams:e.activeLineParams})}))}),this.interactive&&this.chartOverlayParams&&i.push(n.h("rect",{ref:"interactive-area",attrs:Object.assign({},this.chartOverlayParams),on:{mousemove:function(t){return e.mouseMove(t)},mouseout:function(){return e.mouseOut()}}})),n.h("svg",{class:"vtc",ref:"chart",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%"}},i)},install:function(t){t.component(e.name,e)}};return"undefined"!=typeof window&&window.Vue&&window.Vue.use(e),e});
